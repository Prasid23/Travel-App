<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bus Operator Portal | Transit Management System</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #1976d2;
      --primary-dark: #125ea2;
      --primary-light: #e3f2fd;
      --secondary-color: #ff9800;
      --success-color: #4caf50;
      --error-color: #f44336;
      --text-color: #333;
      --text-light: #666;
      --border-color: #ddd;
      --bg-color: #f5f7fa;
      --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s ease;
    }
    
    * { 
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      background-color: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
    }
    
    header {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      color: white;
      padding: 1.5rem 2rem;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
    }
    
    header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
      animation: pulse 15s infinite linear;
    }
    
    header h1 {
      font-weight: 600;
      margin: 0;
      position: relative;
      font-size: 2rem;
    }
    
    header p {
      opacity: 0.9;
      font-weight: 300;
      font-size: 0.9rem;
      margin-top: 0.5rem;
      position: relative;
    }
    
    .container {
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .card {
      background: white;
      padding: 2rem;
      border-radius: 10px;
      margin-bottom: 1.5rem;
      box-shadow: var(--card-shadow);
      transition: var(--transition);
      animation: fadeIn 0.5s ease-out;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }
    
    .card h2, .card h3 {
      color: var(--primary-color);
      margin-bottom: 1.5rem;
      position: relative;
      padding-bottom: 0.5rem;
    }
    
    .card h2::after, .card h3::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 50px;
      height: 3px;
      background: var(--secondary-color);
      border-radius: 3px;
    }
    
    input, button, select, textarea {
      width: 100%;
      padding: 0.8rem 1rem;
      margin-top: 0.8rem;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-family: 'Poppins', sans-serif;
      font-size: 0.9rem;
      transition: var(--transition);
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
    }
    
    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 500;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      font-size: 0.9rem;
    }
    
    button:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    .hidden { 
      display: none; 
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-top: 1rem;
      background-color: var(--primary-color);
      padding: 0.8rem 1.5rem;
      color: white;
      border: none;
      border-radius: 6px;
      text-decoration: none;
      cursor: pointer;
      transition: var(--transition);
      font-weight: 500;
    }
    
    .btn i {
      margin-right: 0.5rem;
    }
    
    .btn:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .btn-secondary {
      background-color: white;
      color: var(--primary-color);
      border: 1px solid var(--primary-color);
    }
    
    .btn-secondary:hover {
      background-color: var(--primary-light);
    }
    
    .btn-danger {
      background-color: var(--error-color);
    }
    
    .btn-success {
      background-color: var(--success-color);
    }
    
    .error-message {
      color: var(--error-color);
      font-size: 0.85rem;
      margin-top: 0.5rem;
      animation: shake 0.5s;
    }
    
    .success-message {
      color: var(--success-color);
      font-size: 0.85rem;
      margin-top: 0.5rem;
    }
    
    .link {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: 500;
      transition: var(--transition);
    }
    
    .link:hover {
      color: var(--primary-dark);
      text-decoration: underline;
    }
    
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }
    
    .dashboard-card {
      background: white;
      border-radius: 10px;
      padding: 1.5rem;
      box-shadow: var(--card-shadow);
      transition: var(--transition);
      text-align: center;
      cursor: pointer;
    }
    
    .dashboard-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }
    
    .dashboard-card i {
      font-size: 2.5rem;
      color: var(--primary-color);
      margin-bottom: 1rem;
    }
    
    .dashboard-card h3 {
      margin: 0.5rem 0;
      color: var(--text-color);
    }
    
    .dashboard-card p {
      color: var(--text-light);
      font-size: 0.9rem;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text-color);
    }
    
    .booking-list {
      list-style: none;
    }
    
    .booking-item {
      background: var(--primary-light);
      padding: 1rem;
      border-radius: 6px;
      margin-bottom: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: var(--transition);
    }
    
    .booking-item:hover {
      background: #d0e3fa;
    }
    
    .booking-info {
      flex: 1;
    }
    
    .booking-info h4 {
      margin-bottom: 0.3rem;
      color: var(--primary-dark);
    }
    
    .booking-info p {
      font-size: 0.85rem;
      color: var(--text-light);
    }
    
    .booking-actions button {
      width: auto;
      margin-left: 1rem;
      padding: 0.5rem 1rem;
    }
    
    .schedule-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1.5rem;
    }
    
    .schedule-table th, .schedule-table td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }
    
    .schedule-table th {
      background-color: var(--primary-light);
      color: var(--primary-dark);
      font-weight: 500;
    }
    
    .schedule-table tr:hover {
      background-color: rgba(25, 118, 210, 0.05);
    }
    
    .status-badge {
      display: inline-block;
      padding: 0.3rem 0.6rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 500;
    }
    
    .status-available {
      background-color: rgba(76, 175, 80, 0.2);
      color: var(--success-color);
    }
    
    .status-unavailable {
      background-color: rgba(244, 67, 54, 0.2);
      color: var(--error-color);
    }
    
    .user-profile {
      display: flex;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid var(--border-color);
    }
    
    .user-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background-color: var(--primary-light);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 1.5rem;
      color: var(--primary-color);
      font-size: 2rem;
      font-weight: bold;
    }
    
    .user-details h2 {
      margin-bottom: 0.5rem;
      color: var(--primary-dark);
    }
    
    .user-details p {
      color: var(--text-light);
      font-size: 0.9rem;
    }
    
    .back-button {
      display: inline-flex;
      align-items: center;
      color: var(--primary-color);
      margin-bottom: 1.5rem;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .back-button:hover {
      color: var(--primary-dark);
      transform: translateX(-3px);
    }
    
    .back-button i {
      margin-right: 0.5rem;
    }
    
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background-color: var(--secondary-color);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: bold;
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    /* Responsive styles */
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }
      
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .booking-item {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .booking-actions {
        margin-top: 1rem;
        width: 100%;
        display: flex;
        justify-content: flex-end;
      }
      
      .user-profile {
        flex-direction: column;
        text-align: center;
      }
      
      .user-avatar {
        margin-right: 0;
        margin-bottom: 1rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1><i class="fas fa-bus"></i> Bus Operator</h1>
    
  </header>
  
  <div class="container">
    <!-- Login Section -->
    <div class="card" id="loginSection">
      <h2><i class="fas fa-sign-in-alt"></i> Operator Login</h2>
      <div class="form-group">
        <label for="loginEmail">Email Address</label>
        <input type="email" id="loginEmail" placeholder="operator@transitpro.com" />
      </div>
      <div class="form-group">
        <label for="loginPassword">Password</label>
        <input type="password" id="loginPassword" placeholder="Enter your password" />
      </div>
      <button onclick="login()"><i class="fas fa-lock"></i> Login</button>
      <p class="text-center" style="margin-top: 1.5rem;">Don't have an account? <a href="#" class="link" onclick="showSignup()">Create one</a></p>
      <p id="loginError" class="error-message"></p>
    </div>

    <!-- Signup Section -->
    <div class="card hidden" id="signupSection">
      <h2><i class="fas fa-user-plus"></i> Operator Registration</h2>
      <div class="form-group">
        <label for="signupName">Full Name</label>
        <input type="text" id="signupName" placeholder="Smita Dhungel" />
      </div>
      <div class="form-group">
        <label for="signupEmail">Email Address</label>
        <input type="email" id="signupEmail" placeholder="operator@transitpro.com" />
      </div>
      <div class="form-group">
        <label for="signupPassword">Password</label>
        <input type="password" id="signupPassword" placeholder="Create a password" />
      </div>
      <div class="form-group">
        <label for="signupCompany">Bus Company</label>
        <input type="text" id="signupCompany" placeholder="Transit Solutions Inc." />
      </div>
      <button onclick="signup()"><i class="fas fa-user-check"></i> Register</button>
      <p class="text-center" style="margin-top: 1.5rem;">Already registered? <a href="#" class="link" onclick="showLogin()">Login here</a></p>
      <p id="signupError" class="error-message"></p>
    </div>

    <!-- Dashboard -->
    <div class="card hidden" id="dashboard">
      <div class="user-profile">
        <div class="user-avatar" id="userAvatar">S</div>
        <div class="user-details">
          <h2 id="userName">Smita Operator</h2>
          <p><i class="fas fa-building"></i> <span id="userCompany">Eay Trp Service</span></p>
          <p><i class="fas fa-envelope"></i> <span id="userEmail">smita@example.com</span></p>
        </div>
      </div>
      
      <h2><i class="fas fa-tachometer-alt"></i> Operator Dashboard</h2>
      
      <!-- Dashboard Stats -->      
      <div class="stats-container" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px;">
        <div class="stat-card" style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
          <i class="fas fa-bus" style="font-size: 24px; color: var(--primary-color);"></i>
          <h3 style="margin: 10px 0;">Total Buses</h3>
          <p id="totalBuses" style="font-size: 24px; font-weight: bold;">0</p>
        </div>
        
        <div class="stat-card" style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
          <i class="fas fa-ticket-alt" style="font-size: 24px; color: var(--primary-color);"></i>
          <h3 style="margin: 10px 0;">Total Bookings</h3>
          <p id="totalBookings" style="font-size: 24px; font-weight: bold;">0</p>
        </div>
        
        <div class="stat-card" style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
          <i class="fas fa-money-bill-wave" style="font-size: 24px; color: var(--primary-color);"></i>
          <h3 style="margin: 10px 0;">Revenue</h3>
          <p id="totalRevenue" style="font-size: 24px; font-weight: bold;">Rs. 0</p>
        </div>
      </div>

      <!-- Recent Bookings -->
      <div class="recent-bookings" style="margin-bottom: 20px;">
        <h3><i class="fas fa-history"></i> Recent Bookings</h3>
        <ul class="booking-list" id="recentBookingsList" style="margin-top: 10px;">
          <li class="booking-item">Loading recent bookings...</li>
        </ul>
      </div>
      
      <!-- Dashboard Cards -->
      <div class="dashboard-cards">
        <div class="card dashboard-card" onclick="showManageBusServices()">
          <div class="card-icon">
            <i class="fas fa-bus"></i>
          </div>
          <div class="card-content">
            <h3>Manage Bus Services</h3>
            <p>Add, edit, or remove bus services</p>
          </div>
        </div>
        
        <div class="card dashboard-card" onclick="showManageSchedules()">
          <div class="card-icon">
            <i class="fas fa-calendar-alt"></i>
          </div>
          <div class="card-content">
            <h3>Manage Schedules</h3>
            <p>Add, edit, or remove bus schedules</p>
          </div>
        </div>
        
        <div class="card dashboard-card" onclick="showViewBookings()">
          <div class="card-icon">
            <i class="fas fa-ticket-alt"></i>
          </div>
          <div class="card-content">
            <h3>View Bookings</h3>
            <p>Manage passenger bookings</p>
          </div>
        </div>
        

        
        <div class="card dashboard-card" onclick="showReports()">
          <div class="card-icon">
            <i class="fas fa-chart-line"></i>
          </div>
          <div class="card-content">
            <h3>Reports</h3>
            <p>View business analytics</p>
          </div>
        </div>
      </div>
      
      <button class="btn btn-danger" onclick="logout()" style="margin-top: 2rem;">
        <i class="fas fa-sign-out-alt"></i> Logout
      </button>
    </div>

    <!-- Manage Schedules -->
    <div class="card hidden" id="manageSchedules">
      <div class="back-button" onclick="backToDashboard()">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      </div>
      
      <h2><i class="fas fa-calendar-alt"></i> Manage Bus Schedules</h2>
      
      <div class="form-group">
        <label>Add New Schedule</label>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
          <select id="scheduleFormBusId" required>
            <option value="">-- Select Bus Service --</option>
            <!-- Bus services will be populated dynamically -->
          </select>
          <input type="date" id="scheduleFormDate" required placeholder="Date" />
          <select id="scheduleFormStatus">
            <option value="available">Available</option>
            <option value="unavailable">Unavailable</option>
          </select>
        </div>
      </div>
      
      <button id="addScheduleBtn" class="btn btn-success"><i class="fas fa-save"></i> Save Schedule</button>
      
      <h3 style="margin-top: 2rem;">Current Schedules</h3>
      
      <div style="overflow-x: auto;">
        <ul class="schedule-list" id="schedulesList">
          <li class="schedule-item">
            <div class="text-center" style="width: 100%; padding: 20px;">
              <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i>
              <p>Loading schedules...</p>
            </div>
          </li>
        </ul>
        
        <!-- Schedule Edit Modal -->
        <div id="scheduleEditModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000;">
          <div style="position: relative; background-color: white; margin: 10% auto; padding: 20px; width: 80%; max-width: 500px; border-radius: 10px; box-shadow: var(--card-shadow);">
            <span style="position: absolute; top: 10px; right: 15px; font-size: 24px; cursor: pointer;" onclick="closeScheduleModal()">&times;</span>
            <h3 style="margin-bottom: 20px;">Edit Schedule</h3>
            
            <div class="form-group">
              <label for="editScheduleDate">Date</label>
              <input type="date" id="editScheduleDate" required>
            </div>
            
            <div class="form-group">
              <label for="editScheduleStatus">Status</label>
              <select id="editScheduleStatus">
                <option value="available">Available</option>
                <option value="unavailable">Unavailable</option>
              </select>
            </div>
            
            <input type="hidden" id="editScheduleId">
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
              <button id="updateScheduleBtn" class="btn btn-success" style="flex: 1;" onclick="updateSchedule()">
                <i class="fas fa-save"></i> Update
              </button>
              <button onclick="closeScheduleModal()" class="btn-secondary" style="flex: 1;">
                <i class="fas fa-times"></i> Cancel
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- View Bookings -->
    <div class="card hidden" id="viewBookings">
      <div class="back-button" onclick="backToDashboard()">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      </div>
      
      <h2><i class="fas fa-clipboard-list"></i> Passenger Bookings</h2>
      
      <div class="form-group" style="display: flex; gap: 1rem;">
        <input type="date" id="bookingFilterDate" placeholder="Filter by date" style="flex: 1;" />
        <select id="bookingFilterRoute" style="flex: 1; max-width: 200px;">
          <option value="">All Routes</option>
          <!-- Routes will be populated dynamically -->
        </select>
        <button id="filterBookingsBtn" style="width: auto; padding: 0 1.5rem;">
          <i class="fas fa-filter"></i> Filter
        </button>
      </div>
      
      <ul class="booking-list" id="bookingsList">
        <li class="booking-item">
          <div class="text-center" style="width: 100%; padding: 20px;">
            <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i>
            <p>Loading bookings...</p>
          </div>
        </li>
      </ul>
      
      <!-- Booking Details Modal -->
      <div id="bookingDetailsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: relative; background-color: white; margin: 10% auto; padding: 20px; width: 80%; max-width: 600px; border-radius: 10px; box-shadow: var(--card-shadow);">
          <span style="position: absolute; top: 10px; right: 15px; font-size: 24px; cursor: pointer;" onclick="closeBookingModal()">&times;</span>
          <h3 style="margin-bottom: 20px;">Booking Details</h3>
          <div id="bookingDetailsContent">
            <!-- Content will be populated dynamically -->
          </div>
          <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button id="confirmBookingBtn" class="btn btn-success" style="flex: 1;">
              <i class="fas fa-check"></i> Confirm Booking
            </button>
            <button id="cancelBookingBtn" class="btn btn-danger" style="flex: 1;">
              <i class="fas fa-times"></i> Cancel Booking
            </button>
            <button id="viewTicketBtn" class="btn-secondary" style="flex: 1;">
              <i class="fas fa-ticket-alt"></i> View Ticket
            </button>
          </div>
        </div>
      </div>
      
      <script>
        function acceptBooking(button) {
          const bookingItem = button.closest('.booking-item');
          const bookingInfo = bookingItem.querySelector('.booking-info h4');
          bookingInfo.innerHTML += ' <span class="status-badge status-available">Accepted</span>';
          bookingItem.querySelector('.btn-danger').remove();
          button.remove();
        }
      
        function rejectBooking(button) {
          const bookingItem = button.closest('.booking-item');
          const bookingInfo = bookingItem.querySelector('.booking-info h4');
          bookingInfo.innerHTML += ' <span class="status-badge status-unavailable">Rejected</span>';
          bookingItem.querySelector('.btn-success').remove();
          button.remove();
        }
      </script>
          <div class="booking-actions">
            <button class="btn-secondary" style="width: auto;">
              <i class="fas fa-print"></i> Ticket
            </button>
          </div>
        </li>
      </ul>
    </div>

    <!-- Manage Bus Services -->
    <div class="card hidden" id="manageBusServices">
      <div class="back-button" onclick="backToDashboard()">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      </div>
      
      <h2><i class="fas fa-bus"></i> Manage Bus Services</h2>
      
      <div class="form-group">
        <label>Add New Bus Service</label>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
          <input type="text" id="busFormName" placeholder="Bus Name (e.g., Mountain Express)" required>
          <input type="text" id="busFormRoute" placeholder="Route (e.g., Kathmandu to Pokhara)" required>
          <select id="busFormType" required>
            <option value="">-- Select Bus Type --</option>
            <option value="ac">AC</option>
            <option value="deluxe">Deluxe</option>
            <option value="tourist">Tourist</option>
            <option value="normal">Normal</option>
          </select>
          <input type="time" id="busFormDepartureTime" placeholder="Departure Time" required>
          <input type="time" id="busFormArrivalTime" placeholder="Arrival Time" required>
          <input type="text" id="busFormDuration" placeholder="Duration (e.g., 6 hours)">
          <input type="number" id="busFormPrice" placeholder="Ticket Price (Rs.)" step="0.01" required>
          <input type="number" id="busFormTotalSeats" placeholder="Total Seats" required>
          <input type="text" id="busFormAmenities" placeholder="Amenities (comma-separated, e.g., wifi,ac,water)">
        </div>
      </div>
      
      <button id="addBusServiceBtn" class="btn btn-success"><i class="fas fa-save"></i> Save Bus Service</button>
      
      <h3 style="margin-top: 2rem;">Your Bus Services</h3>
      
      <div style="overflow-x: auto;">
        <table class="schedule-table" id="busServicesTable">
          <thead>
            <tr>
              <th>Bus Name</th>
              <th>Route</th>
              <th>Type</th>
              <th>Departure</th>
              <th>Arrival</th>
              <th>Price</th>
              <th>Seats</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="busServicesTableBody">
            <tr>
              <td colspan="8" class="text-center">Loading bus services...</td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <!-- Bus Service Edit Modal -->
      <div id="busServiceEditModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: relative; background-color: white; margin: 5% auto; padding: 20px; width: 80%; max-width: 700px; border-radius: 10px; box-shadow: var(--card-shadow); max-height: 90vh; overflow-y: auto;">
          <span style="position: absolute; top: 10px; right: 15px; font-size: 24px; cursor: pointer;" onclick="closeBusServiceModal()">&times;</span>
          <h3 style="margin-bottom: 20px;">Edit Bus Service</h3>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div class="form-group">
              <label for="editBusName">Bus Name</label>
              <input type="text" id="editBusName" required>
            </div>
            
            <div class="form-group">
              <label for="editBusRoute">Route</label>
              <input type="text" id="editBusRoute" required>
            </div>
            
            <div class="form-group">
              <label for="editBusType">Bus Type</label>
              <select id="editBusType" required>
                <option value="ac">AC</option>
                <option value="deluxe">Deluxe</option>
                <option value="tourist">Tourist</option>
                <option value="normal">Normal</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="editBusDepartureTime">Departure Time</label>
              <input type="time" id="editBusDepartureTime" required>
            </div>
            
            <div class="form-group">
              <label for="editBusArrivalTime">Arrival Time</label>
              <input type="time" id="editBusArrivalTime" required>
            </div>
            
            <div class="form-group">
              <label for="editBusDuration">Duration</label>
              <input type="text" id="editBusDuration">
            </div>
            
            <div class="form-group">
              <label for="editBusPrice">Price (Rs.)</label>
              <input type="number" id="editBusPrice" step="0.01" required>
            </div>
            
            <div class="form-group">
              <label for="editBusTotalSeats">Total Seats</label>
              <input type="number" id="editBusTotalSeats" required>
            </div>
            
            <div class="form-group" style="grid-column: span 2;">
              <label for="editBusAmenities">Amenities (comma-separated)</label>
              <input type="text" id="editBusAmenities">
            </div>
          </div>
          
          <input type="hidden" id="editBusServiceId">
          
          <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button id="updateBusServiceBtn" class="btn btn-success" style="flex: 1;" onclick="updateBusService()">
              <i class="fas fa-save"></i> Update
            </button>
            <button onclick="closeBusServiceModal()" class="btn-secondary" style="flex: 1;">
              <i class="fas fa-times"></i> Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Reports Section -->
    <div class="card hidden" id="reportsSection">
      <div class="back-button" onclick="backToDashboard()">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      </div>
      
      <h2><i class="fas fa-chart-line"></i> Operational Reports</h2>
      
      <!-- Summary Cards -->
      <div class="summary-cards" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-top: 1rem;">
        <div class="summary-card" style="background: white; padding: 1rem; border-radius: 8px; box-shadow: var(--card-shadow);">
          <h4 style="margin-bottom: 0.5rem; color: var(--text-dark);">Total Bookings</h4>
          <div style="display: flex; align-items: center; justify-content: space-between;">
            <span id="totalBookingsCount" style="font-size: 1.8rem; font-weight: bold; color: var(--primary-color);">--</span>
            <i class="fas fa-ticket-alt" style="font-size: 1.5rem; color: var(--primary-color); opacity: 0.3;"></i>
          </div>
        </div>
        
        <div class="summary-card" style="background: white; padding: 1rem; border-radius: 8px; box-shadow: var(--card-shadow);">
          <h4 style="margin-bottom: 0.5rem; color: var(--text-dark);">Confirmed</h4>
          <div style="display: flex; align-items: center; justify-content: space-between;">
            <span id="confirmedBookingsCount" style="font-size: 1.8rem; font-weight: bold; color: #28a745;">--</span>
            <i class="fas fa-check-circle" style="font-size: 1.5rem; color: #28a745; opacity: 0.3;"></i>
          </div>
        </div>
        
        <div class="summary-card" style="background: white; padding: 1rem; border-radius: 8px; box-shadow: var(--card-shadow);">
          <h4 style="margin-bottom: 0.5rem; color: var(--text-dark);">Pending</h4>
          <div style="display: flex; align-items: center; justify-content: space-between;">
            <span id="pendingBookingsCount" style="font-size: 1.8rem; font-weight: bold; color: #ffc107;">--</span>
            <i class="fas fa-clock" style="font-size: 1.5rem; color: #ffc107; opacity: 0.3;"></i>
          </div>
        </div>
        
        <div class="summary-card" style="background: white; padding: 1rem; border-radius: 8px; box-shadow: var(--card-shadow);">
          <h4 style="margin-bottom: 0.5rem; color: var(--text-dark);">Revenue</h4>
          <div style="display: flex; align-items: center; justify-content: space-between;">
            <span id="totalRevenueAmount" style="font-size: 1.8rem; font-weight: bold; color: #17a2b8;">--</span>
            <i class="fas fa-rupee-sign" style="font-size: 1.5rem; color: #17a2b8; opacity: 0.3;"></i>
          </div>
        </div>
      </div>
      
      <!-- Charts -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 1.5rem;">
        <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: var(--card-shadow);">
          <h3 style="color: var(--primary-color);">Daily Bookings</h3>
          <div id="bookingsChartContainer" style="height: 250px; margin-top: 1rem;">
            <canvas id="bookingsChart"></canvas>
          </div>
        </div>
        
        <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: var(--card-shadow);">
          <h3 style="color: var(--primary-color);">Revenue Trend</h3>
          <div id="revenueChartContainer" style="height: 250px; margin-top: 1rem;">
            <canvas id="revenueChart"></canvas>
          </div>
        </div>
      </div>
      
      <!-- Popular Routes -->
      <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: var(--card-shadow); margin-top: 2rem;">
        <h3 style="color: var(--primary-color);">Popular Routes</h3>
        <div id="routesChartContainer" style="height: 250px; margin-top: 1rem;">
          <canvas id="routesChart"></canvas>
        </div>
      </div>
      
      <!-- Custom Report Generator -->
      <div style="margin-top: 2rem; background: white; padding: 1.5rem; border-radius: 8px; box-shadow: var(--card-shadow);">
        <h3>Generate Custom Report</h3>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-top: 1rem;">
          <div class="form-group">
            <label>From Date</label>
            <input type="date" id="reportFromDate" />
          </div>
          
          <div class="form-group">
            <label>To Date</label>
            <input type="date" id="reportToDate" />
          </div>
          
          <div class="form-group">
            <label>Report Type</label>
            <select id="reportType">
              <option value="bookings">Bookings</option>
              <option value="revenue">Revenue</option>
              <option value="occupancy">Seat Occupancy</option>
              <option value="cancellations">Cancellations</option>
            </select>
          </div>
        </div>
        
        <button class="btn" id="generateReportBtn" style="margin-top: 1rem;">
          <i class="fas fa-file-download"></i> Generate Report
        </button>
        
        <!-- Report Results -->
        <div id="reportResults" style="margin-top: 1.5rem; display: none;">
          <h4>Report Results</h4>
          <div class="table-responsive">
            <table class="table">
              <thead id="reportTableHead"></thead>
              <tbody id="reportTableBody"></tbody>
            </table>
          </div>
          <button class="btn-secondary" id="downloadReportBtn" style="margin-top: 1rem;">
            <i class="fas fa-download"></i> Download as CSV
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // DOM Elements
    const loginSection = document.getElementById('loginSection');
    const signupSection = document.getElementById('signupSection');
    const dashboard = document.getElementById('dashboard');
    const manageBusServices = document.getElementById('manageBusServices');
    const manageSchedules = document.getElementById('manageSchedules');
    const viewBookings = document.getElementById('viewBookings');
    const reportsSection = document.getElementById('reportsSection');
    const loginError = document.getElementById('loginError');
    const signupError = document.getElementById('signupError');
    const userName = document.getElementById('userName');
    const userEmail = document.getElementById('userEmail');
    const userCompany = document.getElementById('userCompany');
    const userAvatar = document.getElementById('userAvatar');

    // Show Signup Form
    function showSignup() {
      loginSection.classList.add('hidden');
      signupSection.classList.remove('hidden');
      loginError.textContent = "";
    }

    // Show Login Form
    function showLogin() {
      signupSection.classList.add('hidden');
      loginSection.classList.remove('hidden');
      signupError.textContent = "";
    }

    // Login Function
    function login() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;

      // Simple validation
      if (!email || !password) {
        loginError.textContent = "Please enter both email and password.";
        return;
      }

      // Show authenticating message
      loginError.textContent = "Authenticating...";
      
      // Call the login API
      fetch('../php/operator_login.php', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          email: email,
          password: password
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Set user data from API response
          userName.textContent = data.data.name;
          userEmail.textContent = data.data.email;
          userCompany.textContent = data.data.company_name;
          userAvatar.textContent = data.data.name.charAt(0);
          
          // Show dashboard
          loginSection.classList.add('hidden');
          dashboard.classList.remove('hidden');
          loginError.textContent = "";
          
          // Load dashboard data
          loadDashboardData();
          
          // Animate dashboard cards
          animateDashboardCards();
        } else {
          loginError.textContent = data.message || "Invalid email or password. Please try again.";
        }
      })
      .catch(error => {
        console.error('Error:', error);
        loginError.textContent = "An error occurred. Please try again later.";
      });
    }

    // Signup Function
    function signup() {
      const name = document.getElementById('signupName').value;
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;
      const company = document.getElementById('signupCompany').value;

      // Validation
      if (!name || !email || !password || !company) {
        signupError.textContent = "Please fill in all fields.";
        return;
      }

      // Show creating account message
      signupError.textContent = "Creating account...";
      
      // Call the signup API
      fetch('../php/operator_signup.php', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          name: name,
          email: email,
          password: password,
          company_name: company
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Set user data from API response
          userName.textContent = data.data.name;
          userEmail.textContent = data.data.email;
          userCompany.textContent = data.data.company_name;
          userAvatar.textContent = data.data.name.charAt(0);
          
          // Show dashboard
          signupSection.classList.add('hidden');
          dashboard.classList.remove('hidden');
          signupError.textContent = "";
          
          // Load dashboard data
          loadDashboardData();
          
          // Animate dashboard cards
          animateDashboardCards();
        } else {
          signupError.textContent = data.message || "Failed to create account. Please try again.";
        }
      })
      .catch(error => {
        console.error('Error:', error);
        signupError.textContent = "An error occurred. Please try again later.";
      });
    }

    // Show Manage Bus Services
    function showManageBusServices() {
      hideAllSections();
      manageBusServices.classList.remove('hidden');
      loadBusServices();
    }
    
    // Show Manage Schedules
    function showManageSchedules() {
      hideAllSections();
      manageSchedules.classList.remove('hidden');
      loadBusSchedules();
    }

    // Show View Bookings
    function showViewBookings() {
      hideAllSections();
      viewBookings.classList.remove('hidden');
      loadBookings();
    }
    

    
    // Show Reports
    function showReports() {
      hideAllSections();
      reportsSection.classList.remove('hidden');
      loadReportData();
    }
    
    // Load Report Data
    function loadReportData() {
      // Show loading state
      document.getElementById('totalBookingsCount').textContent = '...';  
      document.getElementById('confirmedBookingsCount').textContent = '...';  
      document.getElementById('pendingBookingsCount').textContent = '...';  
      document.getElementById('totalRevenueAmount').textContent = '...';  
      
      // Fetch booking statistics
      fetch('../php/manage_bus_bookings.php?action=get_booking_stats', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({})
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Update summary cards
          document.getElementById('totalBookingsCount').textContent = data.data.total_bookings;
          document.getElementById('confirmedBookingsCount').textContent = data.data.confirmed_bookings;
          document.getElementById('pendingBookingsCount').textContent = data.data.pending_bookings;
          document.getElementById('totalRevenueAmount').textContent = 'Rs. ' + data.data.total_revenue;
          
          // Load charts data
          loadBookingsChart();
          loadRevenueChart();
          loadRoutesChart();
        } else {
          console.error('Error loading booking stats:', data.message);
        }
      })
      .catch(error => {
        console.error('Error loading booking stats:', error);
      });
    }
    
    // Load Bookings Chart
    function loadBookingsChart() {
      fetch('../php/manage_bus_bookings.php?action=get_booking_chart_data', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({})
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          const ctx = document.getElementById('bookingsChart').getContext('2d');
          
          // Sample data if API doesn't return proper data
          const chartData = data.data || {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            confirmed: [5, 8, 12, 7, 10, 15, 20],
            pending: [2, 3, 5, 2, 4, 6, 8],
            cancelled: [1, 2, 1, 3, 2, 1, 3]
          };
          
          new Chart(ctx, {
            type: 'bar',
            data: {
              labels: chartData.labels,
              datasets: [
                {
                  label: 'Confirmed',
                  data: chartData.confirmed,
                  backgroundColor: '#28a745',
                  borderColor: '#28a745',
                  borderWidth: 1
                },
                {
                  label: 'Pending',
                  data: chartData.pending,
                  backgroundColor: '#ffc107',
                  borderColor: '#ffc107',
                  borderWidth: 1
                },
                {
                  label: 'Cancelled',
                  data: chartData.cancelled,
                  backgroundColor: '#dc3545',
                  borderColor: '#dc3545',
                  borderWidth: 1
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                  title: {
                    display: true,
                    text: 'Number of Bookings'
                  }
                }
              }
            }
          });
        } else {
          console.error('Error loading bookings chart data:', data.message);
        }
      })
      .catch(error => {
        console.error('Error loading bookings chart data:', error);
      });
    }
    
    // Load Revenue Chart
    function loadRevenueChart() {
      fetch('../php/manage_bus_bookings.php?action=get_revenue_chart_data', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({})
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          const ctx = document.getElementById('revenueChart').getContext('2d');
          
          // Sample data if API doesn't return proper data
          const chartData = data.data || {
            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
            revenue: [15000, 22000, 18000, 25000]
          };
          
          new Chart(ctx, {
            type: 'line',
            data: {
              labels: chartData.labels,
              datasets: [{
                label: 'Revenue (Rs.)',
                data: chartData.revenue,
                backgroundColor: 'rgba(23, 162, 184, 0.2)',
                borderColor: '#17a2b8',
                borderWidth: 2,
                tension: 0.4,
                fill: true
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                  title: {
                    display: true,
                    text: 'Revenue (Rs.)'
                  }
                }
              }
            }
          });
        } else {
          console.error('Error loading revenue chart data:', data.message);
        }
      })
      .catch(error => {
        console.error('Error loading revenue chart data:', error);
      });
    }
    
    // Load Routes Chart
    function loadRoutesChart() {
      fetch('../php/manage_bus_bookings.php?action=get_popular_routes', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({})
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          const ctx = document.getElementById('routesChart').getContext('2d');
          
          // Sample data if API doesn't return proper data
          const chartData = data.data || {
            routes: ['Kathmandu-Pokhara', 'Kathmandu-Chitwan', 'Pokhara-Lumbini', 'Kathmandu-Butwal', 'Pokhara-Chitwan'],
            bookings: [45, 32, 28, 25, 20]
          };
          
          new Chart(ctx, {
            type: 'horizontalBar',
            data: {
              labels: chartData.routes,
              datasets: [{
                label: 'Number of Bookings',
                data: chartData.bookings,
                backgroundColor: [
                  '#007bff', '#28a745', '#ffc107', '#17a2b8', '#6610f2'
                ],
                borderWidth: 1
              }]
            },
            options: {
              indexAxis: 'y',
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                x: {
                  beginAtZero: true,
                  title: {
                    display: true,
                    text: 'Number of Bookings'
                  }
                }
              }
            }
          });
        } else {
          console.error('Error loading popular routes data:', data.message);
        }
      })
      .catch(error => {
        console.error('Error loading popular routes data:', error);
      });
    }
    
    // Generate Custom Report
    document.getElementById('generateReportBtn').addEventListener('click', function() {
      const fromDate = document.getElementById('reportFromDate').value;
      const toDate = document.getElementById('reportToDate').value;
      const reportType = document.getElementById('reportType').value;
      
      if (!fromDate || !toDate) {
        alert('Please select both from and to dates');
        return;
      }
      
      // Show loading state
      document.getElementById('reportResults').style.display = 'block';
      document.getElementById('reportTableHead').innerHTML = '<tr><th colspan="4">Loading report data...</th></tr>';
      document.getElementById('reportTableBody').innerHTML = '';
      
      fetch('../php/manage_bus_bookings.php?action=generate_report', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          from_date: fromDate,
          to_date: toDate,
          report_type: reportType
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Display report results
          displayReportResults(data.data, reportType);
        } else {
          document.getElementById('reportTableHead').innerHTML = '<tr><th>Error</th></tr>';
          document.getElementById('reportTableBody').innerHTML = `<tr><td>${data.message || 'Failed to generate report'}</td></tr>`;
        }
      })
      .catch(error => {
        console.error('Error generating report:', error);
        document.getElementById('reportTableHead').innerHTML = '<tr><th>Error</th></tr>';
        document.getElementById('reportTableBody').innerHTML = '<tr><td>Failed to generate report. Please try again later.</td></tr>';
      });
    });
    
    // Display Report Results
    function displayReportResults(data, reportType) {
      const tableHead = document.getElementById('reportTableHead');
      const tableBody = document.getElementById('reportTableBody');
      
      // Clear previous results
      tableHead.innerHTML = '';
      tableBody.innerHTML = '';
      
      if (!data || data.length === 0) {
        tableHead.innerHTML = '<tr><th>No Data</th></tr>';
        tableBody.innerHTML = '<tr><td>No data available for the selected criteria</td></tr>';
        return;
      }
      
      // Create table headers based on report type
      let headers = [];
      switch (reportType) {
        case 'bookings':
          headers = ['Date', 'Bus Service', 'Route', 'Bookings', 'Status'];
          break;
        case 'revenue':
          headers = ['Date', 'Bus Service', 'Route', 'Revenue (Rs.)'];
          break;
        case 'occupancy':
          headers = ['Date', 'Bus Service', 'Route', 'Capacity', 'Booked', 'Occupancy %'];
          break;
        case 'cancellations':
          headers = ['Date', 'Bus Service', 'Route', 'Cancellations', 'Reason'];
          break;
      }
      
      // Add headers to table
      let headerRow = '<tr>';
      headers.forEach(header => {
        headerRow += `<th>${header}</th>`;
      });
      headerRow += '</tr>';
      tableHead.innerHTML = headerRow;
      
      // Add data rows
      data.forEach(row => {
        let dataRow = '<tr>';
        switch (reportType) {
          case 'bookings':
            dataRow += `<td>${row.date}</td><td>${row.bus_name}</td><td>${row.route}</td><td>${row.bookings}</td><td>${row.status}</td>`;
            break;
          case 'revenue':
            dataRow += `<td>${row.date}</td><td>${row.bus_name}</td><td>${row.route}</td><td>${row.revenue}</td>`;
            break;
          case 'occupancy':
            dataRow += `<td>${row.date}</td><td>${row.bus_name}</td><td>${row.route}</td><td>${row.capacity}</td><td>${row.booked}</td><td>${row.occupancy_percentage}%</td>`;
            break;
          case 'cancellations':
            dataRow += `<td>${row.date}</td><td>${row.bus_name}</td><td>${row.route}</td><td>${row.cancellations}</td><td>${row.reason || 'N/A'}</td>`;
            break;
        }
        dataRow += '</tr>';
        tableBody.innerHTML += dataRow;
      });
      
      // Show download button
      document.getElementById('downloadReportBtn').style.display = 'inline-block';
    }
    
    // Download Report as CSV
    document.getElementById('downloadReportBtn').addEventListener('click', function() {
      const tableHead = document.getElementById('reportTableHead');
      const tableBody = document.getElementById('reportTableBody');
      
      // Get headers
      const headers = [];
      const headerCells = tableHead.querySelectorAll('th');
      headerCells.forEach(cell => {
        headers.push(cell.textContent);
      });
      
      // Get rows
      const rows = [];
      const bodyCells = tableBody.querySelectorAll('tr');
      bodyCells.forEach(row => {
        const rowData = [];
        row.querySelectorAll('td').forEach(cell => {
          rowData.push(cell.textContent);
        });
        rows.push(rowData);
      });
      
      // Create CSV content
      let csvContent = headers.join(',') + '\n';
      rows.forEach(row => {
        csvContent += row.join(',') + '\n';
      });
      
      // Create download link
      const encodedUri = encodeURI('data:text/csv;charset=utf-8,' + csvContent);
      const link = document.createElement('a');
      link.setAttribute('href', encodedUri);
      link.setAttribute('download', `report_${document.getElementById('reportType').value}_${new Date().toISOString().slice(0,10)}.csv`);
      document.body.appendChild(link);
      
      // Trigger download
      link.click();
      
      // Clean up
      document.body.removeChild(link);
    });

    // Hide all sections
    function hideAllSections() {
      dashboard.classList.add('hidden');
      manageBusServices.classList.add('hidden');
      manageSchedules.classList.add('hidden');
      viewBookings.classList.add('hidden');
      reportsSection.classList.add('hidden');
    }
    
    // Back to Dashboard
    function backToDashboard() {
      hideAllSections();
      dashboard.classList.remove('hidden');
    }

    // Load Bus Services
    function loadBusServices() {
      const busServicesTableBody = document.getElementById('busServicesTableBody');
      if (!busServicesTableBody) return;
      
      busServicesTableBody.innerHTML = `
        <tr>
          <td colspan="8" class="text-center">
            <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i>
            <p>Loading bus services...</p>
          </td>
        </tr>
      `;
      
      fetch('../php/manage_bus_service.php?action=get', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({})
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          if (data.data.length === 0) {
            busServicesTableBody.innerHTML = `
              <tr>
                <td colspan="8" class="text-center">
                  <i class="fas fa-bus-alt" style="font-size: 24px; margin-bottom: 10px;"></i>
                  <p>No bus services found. Add a new bus service to get started.</p>
                </td>
              </tr>
            `;
            return;
          }
          
          busServicesTableBody.innerHTML = '';
          
          data.data.forEach(bus => {
            busServicesTableBody.innerHTML += `
              <tr>
                <td>${bus.bus_name}</td>
                <td>${bus.route}</td>
                <td>${bus.bus_type}</td>
                <td>${bus.departure_time}</td>
                <td>${bus.arrival_time}</td>
                <td>Rs. ${bus.price}</td>
                <td>${bus.total_seats}</td>
                <td>
                  <button class="btn-small btn-primary" onclick="editBusService(${bus.bus_service_id})">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn-small btn-danger" onclick="deleteBusService(${bus.bus_service_id})">
                    <i class="fas fa-trash"></i>
                  </button>
                </td>
              </tr>
            `;
          });
          
          // Also update the bus select dropdown in the schedule form
          const busSelect = document.getElementById('scheduleFormBusId');
          if (busSelect) {
            busSelect.innerHTML = '<option value="">-- Select Bus Service --</option>';
            data.data.forEach(bus => {
              busSelect.innerHTML += `<option value="${bus.bus_service_id}">${bus.bus_name} (${bus.route})</option>`;
            });
          }
        } else {
          busServicesTableBody.innerHTML = `
            <tr>
              <td colspan="8" class="text-center">
                <i class="fas fa-exclamation-circle" style="font-size: 24px; margin-bottom: 10px; color: var(--error-color);"></i>
                <p>Failed to load bus services: ${data.message}</p>
              </td>
            </tr>
          `;
        }
      })
      .catch(error => {
        console.error('Error loading bus services:', error);
        busServicesTableBody.innerHTML = `
          <tr>
            <td colspan="8" class="text-center">
              <i class="fas fa-exclamation-circle" style="font-size: 24px; margin-bottom: 10px; color: var(--error-color);"></i>
              <p>Failed to load bus services. Please try again later.</p>
            </td>
          </tr>
        `;
      });
    }
    
    // Add Bus Service
    function addBusService() {
      const busName = document.getElementById('busFormName').value;
      const route = document.getElementById('busFormRoute').value;
      const busType = document.getElementById('busFormType').value;
      const departureTime = document.getElementById('busFormDepartureTime').value;
      const arrivalTime = document.getElementById('busFormArrivalTime').value;
      const duration = document.getElementById('busFormDuration').value;
      const price = document.getElementById('busFormPrice').value;
      const totalSeats = document.getElementById('busFormTotalSeats').value;
      const amenities = document.getElementById('busFormAmenities').value;
      
      if (!busName || !route || !busType || !departureTime || !arrivalTime || !price || !totalSeats) {
        alert('Please fill all required fields');
        return;
      }
      
      fetch('../php/manage_bus_service.php?action=add', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          bus_name: busName,
          route: route,
          bus_type: busType,
          departure_time: departureTime,
          arrival_time: arrivalTime,
          duration: duration,
          price: price,
          total_seats: totalSeats,
          amenities: amenities
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('Bus service added successfully!');
          // Clear form
          document.getElementById('busFormName').value = '';
          document.getElementById('busFormRoute').value = '';
          document.getElementById('busFormType').value = '';
          document.getElementById('busFormDepartureTime').value = '';
          document.getElementById('busFormArrivalTime').value = '';
          document.getElementById('busFormDuration').value = '';
          document.getElementById('busFormPrice').value = '';
          document.getElementById('busFormTotalSeats').value = '';
          document.getElementById('busFormAmenities').value = '';
          
          // Reload bus services
          loadBusServices();
        } else {
          alert('Failed to add bus service: ' + data.message);
        }
      })
      .catch(error => {
        console.error('Error adding bus service:', error);
        alert('Failed to add bus service. Please try again later.');
      });
    }
    
    // Edit Bus Service
    function editBusService(busServiceId) {
      // Fetch bus service details
      fetch('../php/manage_bus_service.php?action=get', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ bus_service_id: busServiceId })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          const bus = data.data;
          document.getElementById('editBusName').value = bus.bus_name;
          document.getElementById('editBusRoute').value = bus.route;
          document.getElementById('editBusType').value = bus.bus_type;
          document.getElementById('editBusDepartureTime').value = bus.departure_time;
          document.getElementById('editBusArrivalTime').value = bus.arrival_time;
          document.getElementById('editBusDuration').value = bus.duration || '';
          document.getElementById('editBusPrice').value = bus.price;
          document.getElementById('editBusTotalSeats').value = bus.total_seats;
          document.getElementById('editBusAmenities').value = bus.amenities || '';
          document.getElementById('editBusServiceId').value = bus.bus_service_id;
          
          // Show modal
          document.getElementById('busServiceEditModal').style.display = 'block';
        } else {
          alert('Failed to load bus service details: ' + data.message);
        }
      })
      .catch(error => {
        console.error('Error loading bus service details:', error);
        alert('Failed to load bus service details. Please try again later.');
      });
    }
    
    // Close Bus Service Modal
    function closeBusServiceModal() {
      document.getElementById('busServiceEditModal').style.display = 'none';
    }
    
    // Update Bus Service
    function updateBusService() {
      const busServiceId = document.getElementById('editBusServiceId').value;
      const busName = document.getElementById('editBusName').value;
      const route = document.getElementById('editBusRoute').value;
      const busType = document.getElementById('editBusType').value;
      const departureTime = document.getElementById('editBusDepartureTime').value;
      const arrivalTime = document.getElementById('editBusArrivalTime').value;
      const duration = document.getElementById('editBusDuration').value;
      const price = document.getElementById('editBusPrice').value;
      const totalSeats = document.getElementById('editBusTotalSeats').value;
      const amenities = document.getElementById('editBusAmenities').value;
      
      if (!busServiceId || !busName || !route || !busType || !departureTime || !arrivalTime || !price || !totalSeats) {
        alert('Please fill all required fields');
        return;
      }
      
      fetch('../php/manage_bus_service.php?action=update', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          bus_service_id: busServiceId,
          bus_name: busName,
          route: route,
          bus_type: busType,
          departure_time: departureTime,
          arrival_time: arrivalTime,
          duration: duration,
          price: price,
          total_seats: totalSeats,
          amenities: amenities
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('Bus service updated successfully!');
          closeBusServiceModal();
          loadBusServices();
        } else {
          alert('Failed to update bus service: ' + data.message);
        }
      })
      .catch(error => {
        console.error('Error updating bus service:', error);
        alert('Failed to update bus service. Please try again later.');
      });
    }
    
    // Load Bookings
    function loadBookings(date = null, route = null) {
      const bookingsList = document.getElementById('bookingsList');
      if (!bookingsList) return;
      
      bookingsList.innerHTML = `
        <li class="booking-item">
          <div class="text-center" style="width: 100%; padding: 20px;">
            <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i>
            <p>Loading bookings...</p>
          </div>
        </li>
      `;
      
      // Prepare request data
      let requestData = {};
      if (date) requestData.date = date;
      if (route) requestData.route = route;
      
      // Fetch bookings
      fetch('../php/manage_bus_bookings.php?action=get_bookings', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(requestData)
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          if (data.data.length === 0) {
            bookingsList.innerHTML = `
              <li class="booking-item">
                <div class="text-center" style="width: 100%; padding: 20px;">
                  <i class="fas fa-info-circle" style="font-size: 24px; margin-bottom: 10px; color: var(--primary-color);"></i>
                  <p>No bookings found</p>
                </div>
              </li>
            `;
          } else {
            bookingsList.innerHTML = '';
            data.data.forEach(booking => {
              const statusClass = 
                booking.booking_status === 'confirmed' ? 'status-confirmed' : 
                booking.booking_status === 'pending' ? 'status-pending' : 'status-cancelled';
              
              bookingsList.innerHTML += `
                <li class="booking-item">
                  <div class="booking-info">
                    <h4>Booking #${booking.booking_id} <span class="status-badge ${statusClass}">${booking.booking_status}</span></h4>
                    <p><i class="fas fa-bus"></i> ${booking.bus_name} (${booking.route}) | <i class="fas fa-calendar"></i> ${new Date(booking.journey_date).toLocaleDateString()}</p>
                    <p><i class="fas fa-chair"></i> Seats: ${booking.seat_numbers || 'Not specified'} | <i class="fas fa-users"></i> ${booking.num_seats} passenger(s)</p>
                  </div>
                  <div class="booking-actions">
                    <button class="btn-secondary" style="width: auto;" onclick="viewBookingDetails(${booking.booking_id})">
                      <i class="fas fa-eye"></i> Details
                    </button>
                  </div>
                </li>
              `;
            });
          }
        } else {
          bookingsList.innerHTML = `
            <li class="booking-item">
              <div class="text-center" style="width: 100%; padding: 20px;">
                <i class="fas fa-exclamation-circle" style="font-size: 24px; margin-bottom: 10px; color: var(--error-color);"></i>
                <p>Error: ${data.message || 'Failed to load bookings'}</p>
              </div>
            </li>
          `;
        }
      })
      .catch(error => {
        console.error('Error loading bookings:', error);
        bookingsList.innerHTML = `
          <li class="booking-item">
            <div class="text-center" style="width: 100%; padding: 20px;">
              <i class="fas fa-exclamation-circle" style="font-size: 24px; margin-bottom: 10px; color: var(--error-color);"></i>
              <p>Failed to load bookings. Please try again later.</p>
            </div>
          </li>
        `;
      });
    }
    
    // View Booking Details
    function viewBookingDetails(bookingId) {
      // Show modal
      const modal = document.getElementById('bookingDetailsModal');
      if (!modal) return;
      
      modal.style.display = 'block';
      
      // Show loading state in modal
      const contentDiv = document.getElementById('bookingDetailsContent');
      if (contentDiv) {
        contentDiv.innerHTML = `
          <div class="text-center" style="padding: 20px;">
            <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i>
            <p>Loading booking details...</p>
          </div>
        `;
      }
      
      // Fetch booking details
      fetch('../php/manage_bus_bookings.php?action=get_booking_details', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ booking_id: bookingId })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success && contentDiv) {
          const booking = data.data;
          const statusClass = 
            booking.booking_status === 'confirmed' ? 'status-confirmed' : 
            booking.booking_status === 'pending' ? 'status-pending' : 'status-cancelled';
          
          contentDiv.innerHTML = `
            <div style="margin-bottom: 20px;">
              <span class="status-badge ${statusClass}" style="float: right;">${booking.booking_status}</span>
              <h4 style="margin-bottom: 10px;">Booking #${booking.booking_id}</h4>
              <p style="color: var(--text-light); font-size: 0.9rem;">Created on ${new Date(booking.created_at).toLocaleString()}</p>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
              <div>
                <h5 style="font-size: 0.9rem; color: var(--text-light); margin-bottom: 5px;">Booking Information</h5>
                <p><strong>User ID:</strong> ${booking.user_id || 'Not available'}</p>
                <p><strong>Number of Seats:</strong> ${booking.num_seats}</p>
                <p><strong>Status:</strong> ${booking.booking_status}</p>
              </div>
              
              <div>
                <h5 style="font-size: 0.9rem; color: var(--text-light); margin-bottom: 5px;">Journey Details</h5>
                <p><strong>${booking.bus_name}</strong> (${booking.bus_type || 'Standard'})</p>
                <p>${booking.route}</p>
                <p>${new Date(booking.journey_date).toLocaleDateString()}</p>
              </div>
            </div>
            
            <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
              <h5 style="font-size: 0.9rem; color: var(--text-light); margin-bottom: 10px;">Seat Information</h5>
              <div style="display: flex; justify-content: space-between;">
                <div>
                  <p><strong>Seat Numbers:</strong> ${booking.seat_numbers || 'Not specified'}</p>
                  <p><strong>Number of Seats:</strong> ${booking.num_seats}</p>
                </div>
                <div>
                  <p><strong>Total Amount:</strong> Rs. ${booking.total_amount}</p>
                  <p><strong>Journey Date:</strong> ${new Date(booking.journey_date).toLocaleDateString()}</p>
                </div>
              </div>
            </div>
          `;
          
          // Set up action buttons based on booking status
          const confirmBtn = document.getElementById('confirmBookingBtn');
          const cancelBtn = document.getElementById('cancelBookingBtn');
          const viewTicketBtn = document.getElementById('viewTicketBtn');
          
          if (confirmBtn && cancelBtn && viewTicketBtn) {
            // Store booking ID for action buttons
            confirmBtn.setAttribute('data-booking-id', booking.booking_id);
            cancelBtn.setAttribute('data-booking-id', booking.booking_id);
            viewTicketBtn.setAttribute('data-booking-id', booking.booking_id);
            
            // Show/hide buttons based on status
            if (booking.booking_status === 'pending') {
              confirmBtn.style.display = 'block';
              cancelBtn.style.display = 'block';
              viewTicketBtn.style.display = 'none';
            } else if (booking.booking_status === 'confirmed') {
              confirmBtn.style.display = 'none';
              cancelBtn.style.display = 'block';
              viewTicketBtn.style.display = 'block';
            } else { // cancelled
              confirmBtn.style.display = 'block';
              cancelBtn.style.display = 'none';
              viewTicketBtn.style.display = 'none';
            }
          }
        } else if (contentDiv) {
          contentDiv.innerHTML = `
            <div class="text-center" style="padding: 20px;">
              <i class="fas fa-exclamation-circle" style="font-size: 24px; margin-bottom: 10px; color: var(--error-color);"></i>
              <p>Error: ${data.message || 'Failed to load booking details'}</p>
            </div>
          `;
        }
      })
      .catch(error => {
        console.error('Error loading booking details:', error);
        if (contentDiv) {
          contentDiv.innerHTML = `
            <div class="text-center" style="padding: 20px;">
              <i class="fas fa-exclamation-circle" style="font-size: 24px; margin-bottom: 10px; color: var(--error-color);"></i>
              <p>Failed to load booking details. Please try again later.</p>
            </div>
          `;
        }
      });
    }
    
    // Close Booking Modal
    function closeBookingModal() {
      const modal = document.getElementById('bookingDetailsModal');
      if (modal) modal.style.display = 'none';
    }
    
    // Update Booking Status
    function updateBookingStatus(bookingId, status) {
      fetch('../php/manage_bus_bookings.php?action=update_status', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          booking_id: bookingId,
          status: status
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert(`Booking ${status} successfully!`);
          closeBookingModal();
          loadBookings(); // Reload bookings list
        } else {
          alert('Failed to update booking: ' + (data.message || 'Unknown error'));
        }
      })
      .catch(error => {
        console.error('Error updating booking:', error);
        alert('An error occurred. Please try again later.');
      });
    }
    
    // Delete Bus Service
    function deleteBusService(busServiceId) {
      if (!confirm('Are you sure you want to delete this bus service? This will also delete all associated schedules and bookings.')) {
        return;
      }
      
      fetch('../php/manage_bus_service.php?action=delete', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ bus_service_id: busServiceId })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('Bus service deleted successfully!');
          loadBusServices();
        } else {
          alert('Failed to delete bus service: ' + data.message);
        }
      })
      .catch(error => {
        console.error('Error deleting bus service:', error);
        alert('Failed to delete bus service. Please try again later.');
      });
    }
    
    // Logout Function
    function logout() {
      // Show loading state
      const logoutBtn = document.querySelector('#dashboard .btn-danger');
      logoutBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging out...';
      
      // Call logout API
      fetch('../php/operator_logout.php', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        }
      })
      .then(response => response.json())
      .then(data => {
        // Reset form fields
        document.getElementById('loginEmail').value = '';
        document.getElementById('loginPassword').value = '';
        document.getElementById('signupName').value = '';
        document.getElementById('signupEmail').value = '';
        document.getElementById('signupPassword').value = '';
        document.getElementById('signupCompany').value = '';
        
        // Show login screen
        dashboard.classList.add('hidden');
        loginSection.classList.remove('hidden');
        
        // Show logout message
        loginError.textContent = "You have been successfully logged out.";
        loginError.style.color = "green";
        setTimeout(() => {
          loginError.textContent = "";
          loginError.style.color = "";
        }, 3000);
      })
      .catch(error => {
        console.error('Error:', error);
        // Still logout the user locally even if API fails
        dashboard.classList.add('hidden');
        loginSection.classList.remove('hidden');
      });
    }
    
    // Animate dashboard cards on load
    function animateDashboardCards() {
      const cards = document.querySelectorAll('.dashboard-card');
      cards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
        card.classList.add('animated');
      });
    }
    
    // Load Dashboard Data
    function loadDashboardData() {
      fetch('../php/get_operator_dashboard.php')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Update dashboard stats - check if elements exist first
            const totalBusesElement = document.getElementById('totalBuses');
            const totalBookingsElement = document.getElementById('totalBookings');
            const totalRevenueElement = document.getElementById('totalRevenue');
            
            if (totalBusesElement) totalBusesElement.textContent = data.data.summary.total_buses;
            if (totalBookingsElement) totalBookingsElement.textContent = data.data.summary.total_bookings;
            if (totalRevenueElement) totalRevenueElement.textContent = `Rs. ${data.data.summary.total_revenue}`;
            
            // Update recent bookings - check if element exists first
            const bookingsList = document.getElementById('recentBookingsList');
            if (bookingsList) {
              bookingsList.innerHTML = '';
              
              if (data.data.recent_bookings.length === 0) {
                bookingsList.innerHTML = '<li class="booking-item">No recent bookings found.</li>';
              } else {
                data.data.recent_bookings.forEach(booking => {
                  const statusClass = booking.booking_status === 'confirmed' ? 'status-confirmed' : 
                                     booking.booking_status === 'pending' ? 'status-pending' : 'status-cancelled';
                  
                  bookingsList.innerHTML += `
                    <li class="booking-item">
                      <div>
                        <h4>${booking.bus_name}</h4>
                        <p>${booking.route}</p>
                        <p>Journey: ${new Date(booking.journey_date).toLocaleDateString()}</p>
                      </div>
                      <div>
                        <span class="status-badge ${statusClass}">${booking.booking_status}</span>
                        <p>Seats: ${booking.num_seats}</p>
                        <p>Amount: Rs. ${booking.total_amount}</p>
                      </div>
                    </li>
                  `;
                });
              }
            }
            
            // Update bus services - check if element exists first
            const busServicesList = document.getElementById('busServicesList');
            if (busServicesList) {
              busServicesList.innerHTML = '';
              
              if (data.data.bus_services.length === 0) {
                busServicesList.innerHTML = '<tr><td colspan="5">No bus services found.</td></tr>';
              } else {
                data.data.bus_services.forEach(bus => {
                  busServicesList.innerHTML += `
                    <tr>
                      <td>${bus.bus_name}</td>
                      <td>${bus.route}</td>
                      <td>${bus.bus_type}</td>
                      <td>Rs. ${bus.price}</td>
                      <td>
                        <button class="btn-small btn-primary" onclick="editBusService(${bus.bus_service_id})">
                          <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-small btn-danger" onclick="deleteBusService(${bus.bus_service_id})">
                          <i class="fas fa-trash"></i>
                        </button>
                      </td>
                    </tr>
                  `;
                });
              }
            }
            
            // Populate bus dropdown in schedule management
            const busSelect = document.getElementById('scheduleFormBusId');
            if (busSelect) {
              busSelect.innerHTML = '<option value="">-- Select Bus Service --</option>';
              if (data.data.bus_services && data.data.bus_services.length > 0) {
                data.data.bus_services.forEach(bus => {
                  busSelect.innerHTML += `<option value="${bus.bus_service_id}">${bus.bus_name} (${bus.route})</option>`;
                });
              }
            }
          } else {
            console.error('Failed to load dashboard data:', data.message);
          }
        })
        .catch(error => {
          console.error('Error loading dashboard data:', error);
        });
    }
    
    // Load Bus Schedules
    function loadBusSchedules(busServiceId = null) {
      const schedulesList = document.getElementById('schedulesList');
      if (!schedulesList) return;
      
      schedulesList.innerHTML = `
        <div class="text-center" style="padding: 20px;">
          <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i>
          <p>Loading schedules...</p>
        </div>
      `;
      
      const url = busServiceId ? 
        `../php/manage_bus_schedule.php?action=get&bus_service_id=${busServiceId}` : 
        '../php/manage_bus_schedule.php?action=get';
      
      fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({})
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          if (data.data.length === 0) {
            schedulesList.innerHTML = `
              <div class="text-center" style="padding: 20px;">
                <i class="fas fa-calendar-times" style="font-size: 24px; margin-bottom: 10px;"></i>
                <p>No schedules found. Add a new schedule to get started.</p>
              </div>
            `;
            return;
          }
          
          schedulesList.innerHTML = '';
          
          data.data.forEach(schedule => {
            const statusClass = schedule.status === 'available' ? 'status-available' : 'status-unavailable';
            
            schedulesList.innerHTML += `
              <li class="schedule-item">
                <div class="schedule-info">
                  <h4>${schedule.bus_name || 'Bus'} <span class="status-badge ${statusClass}">${schedule.status}</span></h4>
                  <p><i class="fas fa-route"></i> ${schedule.route || 'Route not specified'}</p>
                  <p>
                    <i class="fas fa-calendar"></i> ${new Date(schedule.date).toLocaleDateString()}
                  </p>
                </div>
                <div class="schedule-actions">
                  <button class="btn-secondary" onclick="editSchedule(${schedule.schedule_id})">
                    <i class="fas fa-edit"></i> Edit
                  </button>
                  <button class="btn-danger" onclick="deleteSchedule(${schedule.schedule_id})">
                    <i class="fas fa-trash"></i> Delete
                  </button>
                </div>
              </li>
            `;
          });
        } else {
          schedulesList.innerHTML = `
            <div class="text-center" style="padding: 20px;">
              <i class="fas fa-exclamation-circle" style="font-size: 24px; margin-bottom: 10px; color: var(--error-color);"></i>
              <p>Failed to load schedules: ${data.message}</p>
            </div>
          `;
        }
      })
      .catch(error => {
        console.error('Error loading schedules:', error);
        schedulesList.innerHTML = `
          <div class="text-center" style="padding: 20px;">
            <i class="fas fa-exclamation-circle" style="font-size: 24px; margin-bottom: 10px; color: var(--error-color);"></i>
            <p>Failed to load schedules. Please try again later.</p>
          </div>
        `;
      });
    }
    
    // Add Bus Schedule
    function addSchedule() {
      const busServiceId = document.getElementById('scheduleFormBusId').value;
      const departureDate = document.getElementById('scheduleFormDate').value;
      const status = document.getElementById('scheduleFormStatus').value;
      
      if (!busServiceId || !departureDate) {
        alert('Please fill all required fields');
        return;
      }
      
      fetch('../php/manage_bus_schedule.php?action=add', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          bus_service_id: busServiceId,
          departure_date: departureDate,
          status: status
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('Schedule added successfully!');
          // Clear form
          document.getElementById('scheduleFormDate').value = '';
          // Reload schedules
          loadBusSchedules();
        } else {
          alert('Failed to add schedule: ' + data.message);
        }
      })
      .catch(error => {
        console.error('Error adding schedule:', error);
        alert('Failed to add schedule. Please try again later.');
      });
    }
    
    // Edit Bus Schedule
    function editSchedule(scheduleId) {
      // Fetch schedule details
      fetch('../php/manage_bus_schedule.php?action=get', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ schedule_id: scheduleId })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          const schedule = data.data;
          document.getElementById('editScheduleDate').value = schedule.date;
          document.getElementById('editScheduleStatus').value = schedule.status;
          document.getElementById('editScheduleId').value = schedule.schedule_id;
          
          // Show modal
          document.getElementById('scheduleEditModal').style.display = 'block';
        } else {
          alert('Failed to load schedule details: ' + data.message);
        }
      })
      .catch(error => {
        console.error('Error loading schedule details:', error);
        alert('Failed to load schedule details. Please try again later.');
      });
    }
    
    // Close Schedule Modal
    function closeScheduleModal() {
      document.getElementById('scheduleEditModal').style.display = 'none';
    }
    
    // Update Schedule
    function updateSchedule() {
      const scheduleId = document.getElementById('editScheduleId').value;
      const date = document.getElementById('editScheduleDate').value;
      const status = document.getElementById('editScheduleStatus').value;
      
      if (!scheduleId || !date) {
        alert('Please fill all required fields');
        return;
      }
      
      fetch('../php/manage_bus_schedule.php?action=update', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          schedule_id: scheduleId,
          departure_date: date,
          status: status
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('Schedule updated successfully!');
          closeScheduleModal();
          loadBusSchedules();
        } else {
          alert('Failed to update schedule: ' + data.message);
        }
      })
      .catch(error => {
        console.error('Error updating schedule:', error);
        alert('Failed to update schedule. Please try again later.');
      });
    }
    
    // Delete Schedule
    function deleteSchedule(scheduleId) {
      if (!confirm('Are you sure you want to delete this schedule?')) {
        return;
      }
      
      fetch('../php/manage_bus_schedule.php?action=delete', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ schedule_id: scheduleId })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('Schedule deleted successfully!');
          loadBusSchedules();
        } else {
          alert('Failed to delete schedule: ' + data.message);
        }
      })
      .catch(error => {
        console.error('Error deleting schedule:', error);
        alert('Failed to delete schedule. Please try again later.');
      });
    }
    
    // Delete Bus Schedule
    function deleteSchedule(scheduleId) {
      if (confirm('Are you sure you want to delete this schedule?')) {
        fetch('../php/manage_bus_schedule.php?action=delete', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            schedule_id: scheduleId
          })
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert('Schedule deleted successfully!');
            loadBusSchedules();
          } else {
            alert('Failed to delete schedule: ' + data.message);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('An error occurred. Please try again later.');
        });
      }
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      // Add animation to header elements
      const headerElements = document.querySelectorAll('header h1, header p');
      headerElements.forEach((el, index) => {
        el.style.animationDelay = `${index * 0.2}s`;
      });
      
      // Set up event listeners for bus service management
      const addBusServiceBtn = document.getElementById('addBusServiceBtn');
      if (addBusServiceBtn) {
        addBusServiceBtn.addEventListener('click', addBusService);
      }
      
      // Set up event listeners for schedule management
      const addScheduleBtn = document.getElementById('addScheduleBtn');
      if (addScheduleBtn) {
        addScheduleBtn.addEventListener('click', addSchedule);
      }
      
      // Set up event listeners for booking management
      const filterBookingsBtn = document.getElementById('filterBookingsBtn');
      if (filterBookingsBtn) {
        filterBookingsBtn.addEventListener('click', () => {
          const date = document.getElementById('bookingFilterDate').value;
          const route = document.getElementById('bookingFilterRoute').value;
          loadBookings(date, route);
        });
      }
      
      // Set up event listeners for booking modal actions
      const confirmBookingBtn = document.getElementById('confirmBookingBtn');
      const cancelBookingBtn = document.getElementById('cancelBookingBtn');
      const viewTicketBtn = document.getElementById('viewTicketBtn');
      
      if (confirmBookingBtn) {
        confirmBookingBtn.addEventListener('click', () => {
          const bookingId = confirmBookingBtn.getAttribute('data-booking-id');
          updateBookingStatus(bookingId, 'confirmed');
        });
      }
      
      if (cancelBookingBtn) {
        cancelBookingBtn.addEventListener('click', () => {
          const bookingId = cancelBookingBtn.getAttribute('data-booking-id');
          updateBookingStatus(bookingId, 'cancelled');
        });
      }
      
      if (viewTicketBtn) {
        viewTicketBtn.addEventListener('click', () => {
          const bookingId = viewTicketBtn.getAttribute('data-booking-id');
          window.open(`booking-details.html?booking_id=${bookingId}`, '_blank');
        });
      }
      
      // Check if user is already logged in
      fetch('../php/check_operator_session.php')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Set user data from session
            userName.textContent = data.data.name;
            userEmail.textContent = data.data.email;
            userCompany.textContent = data.data.company_name;
            userAvatar.textContent = data.data.name.charAt(0);
            
            // Show dashboard
            loginSection.classList.add('hidden');
            dashboard.classList.remove('hidden');
            
            // Load dashboard data
            loadDashboardData();
            
            // Animate dashboard cards
            animateDashboardCards();
          }
        })
        .catch(error => {
          console.error('Error checking session:', error);
        });
    });
  </script>
</body>
</html>